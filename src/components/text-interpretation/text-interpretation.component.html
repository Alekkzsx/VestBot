<div class="animate-fade-in font-sans text-slate-900 h-full flex flex-col">
  
  @if (!activity() && !loading()) {
    <div class="flex-1 flex flex-col items-center justify-center bg-white rounded-2xl border border-slate-200 shadow-sm p-16 text-center max-w-2xl mx-auto mt-10">
      <div class="w-20 h-20 bg-slate-100 rounded-2xl flex items-center justify-center text-slate-900 text-3xl mb-8">
        <i class="fas fa-book-open"></i>
      </div>
      <h2 class="text-3xl font-bold text-slate-900 mb-4">Interpretação de Texto</h2>
      <p class="text-slate-500 mb-10 leading-relaxed max-w-md mx-auto">
        A IA irá gerar um texto no padrão ETEC com questões focadas em inferência, coesão e coerência.
      </p>
      <button 
        (click)="generateActivity()" 
        class="bg-black hover:bg-slate-800 text-white px-8 py-3 rounded-lg font-bold shadow-lg transition-all hover:-translate-y-1"
      >
        Gerar Novo Texto
      </button>
    </div>
  }

  @if (loading()) {
    <div class="flex-1 flex flex-col items-center justify-center p-10">
      <div class="w-12 h-12 border-4 border-slate-200 border-t-black rounded-full animate-spin mb-6"></div>
      <p class="text-slate-500 font-medium">Escrevendo texto...</p>
    </div>
  }

  @if (activity()) {
    <div class="flex flex-col lg:flex-row gap-8 h-full items-start">
      
      <!-- Text (Reading Pane) -->
      <div class="w-full lg:w-1/2 bg-white border border-slate-200 rounded-2xl overflow-hidden flex flex-col lg:h-[calc(100vh-140px)] shadow-sm">
        <div class="p-8 border-b border-slate-100 bg-slate-50">
          <h3 class="font-bold text-xl text-slate-900 font-serif leading-tight">{{ activity()?.title }}</h3>
        </div>
        <div class="p-10 overflow-y-auto leading-loose text-slate-700 text-lg font-serif">
          {{ activity()?.textContent }}
        </div>
      </div>

      <!-- Questions -->
      <div class="w-full lg:w-1/2 flex flex-col gap-6 lg:h-[calc(100vh-140px)] overflow-y-auto pb-10">
        
        <div class="bg-white border border-slate-200 p-4 rounded-xl shadow-sm flex justify-between items-center sticky top-0 z-10">
          <span class="font-bold text-sm text-slate-900 uppercase tracking-wide">Questões</span>
          @if (showResults()) {
            <span class="bg-black text-white px-3 py-1 rounded text-xs font-bold">Acertos: {{ score() }}/{{ activity()?.questions?.length }}</span>
          }
        </div>

        @for (q of activity()?.questions; track $index; let qIdx = $index) {
          <div class="bg-white border border-slate-200 p-8 rounded-2xl shadow-sm transition-shadow hover:shadow-md"
               [class.border-green-500]="showResults() && selectedOptions()[qIdx] === q.correctIndex"
               [class.border-red-500]="showResults() && selectedOptions()[qIdx] !== q.correctIndex && selectedOptions()[qIdx] !== undefined">
            
            <p class="font-semibold text-slate-900 mb-6 text-lg"><span class="text-slate-300 mr-3">{{ qIdx + 1 }}.</span> {{ q.statement }}</p>

            <div class="space-y-3">
              @for (opt of q.options; track $index; let oIdx = $index) {
                <button 
                  (click)="selectOption(qIdx, oIdx)"
                  class="w-full text-left p-4 rounded-lg border transition-all flex items-center group"
                  [class.border-slate-100]="selectedOptions()[qIdx] !== oIdx && !showResults()"
                  [class.bg-white]="selectedOptions()[qIdx] !== oIdx && !showResults()"
                  [class.hover:bg-slate-50]="!showResults()"
                  
                  [class.bg-slate-900]="selectedOptions()[qIdx] === oIdx && !showResults()"
                  [class.text-white]="selectedOptions()[qIdx] === oIdx && !showResults()"
                  [class.border-slate-900]="selectedOptions()[qIdx] === oIdx && !showResults()"

                  [class.bg-green-100]="showResults() && q.correctIndex === oIdx"
                  [class.border-green-500]="showResults() && q.correctIndex === oIdx"
                  [class.text-green-900]="showResults() && q.correctIndex === oIdx"

                  [class.bg-red-50]="showResults() && selectedOptions()[qIdx] === oIdx && q.correctIndex !== oIdx"
                  [class.border-red-500]="showResults() && selectedOptions()[qIdx] === oIdx && q.correctIndex !== oIdx"
                  [class.text-red-900]="showResults() && selectedOptions()[qIdx] === oIdx && q.correctIndex !== oIdx"
                  
                  [disabled]="showResults()"
                >
                  <span class="w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold mr-4 shrink-0"
                    [class.bg-slate-100]="selectedOptions()[qIdx] !== oIdx && !showResults()"
                    [class.text-slate-500]="selectedOptions()[qIdx] !== oIdx && !showResults()"
                    
                    [class.bg-white]="selectedOptions()[qIdx] === oIdx && !showResults()"
                    [class.text-black]="selectedOptions()[qIdx] === oIdx && !showResults()"

                    [class.bg-green-500]="showResults() && q.correctIndex === oIdx"
                    [class.text-white]="showResults() && q.correctIndex === oIdx"
                  >
                    {{ ['A','B','C','D','E'][oIdx] }}
                  </span>
                  {{ opt }}
                </button>
              }
            </div>

            @if (showResults()) {
              <div class="mt-6 p-4 bg-slate-50 rounded-lg text-sm text-slate-600 leading-relaxed border-l-4 border-slate-900">
                <span class="font-bold text-black block mb-1">Explicação:</span>
                {{ q.explanation }}
              </div>
            }
          </div>
        }

        @if (!showResults()) {
          <button 
            (click)="checkAnswers()"
            [disabled]="!allAnswered()"
            class="w-full py-4 bg-black text-white font-bold rounded-xl shadow-lg hover:bg-slate-800 transition-colors disabled:opacity-30 disabled:cursor-not-allowed disabled:shadow-none mb-8"
          >
            Verificar Respostas
          </button>
        } @else {
           <button 
            (click)="generateActivity()"
            class="w-full py-4 bg-white border-2 border-slate-200 text-slate-900 font-bold rounded-xl hover:bg-slate-50 transition-colors mb-8"
          >
            Próximo Texto <i class="fas fa-arrow-right ml-2"></i>
          </button>
        }
      </div>
    </div>
  }
</div>
<div class="analytics-container">
    @if (data(); as analytics) {
    <!-- Header -->
    <div class="header">
        <h1 class="title">Relat√≥rios e Analytics</h1>
        <p class="subtitle">Acompanhe seu progresso e desempenho detalhado</p>
    </div>

    <!-- Overview Stats -->
    <div class="section">
        <h2 class="section-title">üìä Resumo Geral</h2>
        <div class="grid grid-4">
            <div class="card stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-value">{{ analytics.overview.totalQuestions }}</div>
                <div class="stat-label">Quest√µes Respondidas</div>
            </div>

            <div class="card stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-value">{{ analytics.overview.accuracy }}%</div>
                <div class="stat-label">Taxa de Acerto</div>
            </div>

            <div class="card stat-card">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-value">{{ analytics.overview.totalXP }}</div>
                <div class="stat-label">XP Total</div>
            </div>

            <div class="card stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-value">{{ analytics.overview.currentStreak }}</div>
                <div class="stat-label">Dias de Streak</div>
            </div>
        </div>
    </div>

    <!-- Subject Performance -->
    <div class="section">
        <h2 class="section-title">üìö Desempenho por Mat√©ria</h2>
        <div class="grid grid-2">
            <div class="card">
                <h3 style="font-size: 15px; font-weight: 600; margin: 0 0 16px 0;">Quest√µes por Mat√©ria</h3>
                <div class="bar-chart">
                    @for (subject of analytics.bySubject; track subject.subject) {
                    <div class="bar-item">
                        <div class="bar-label">
                            {{ getSubjectIcon(subject.subject) }} {{ subject.subject }}
                        </div>
                        <div class="bar-track">
                            <div class="bar-fill"
                                [style.width.%]="(subject.totalQuestions / analytics.overview.totalQuestions) * 100">
                                <span class="bar-value">{{ subject.totalQuestions }}</span>
                            </div>
                        </div>
                    </div>
                    }
                </div>
            </div>

            <div class="card">
                <h3 style="font-size: 15px; font-weight: 600; margin: 0 0 16px 0;">Acur√°cia por Mat√©ria</h3>
                <div class="bar-chart">
                    @for (subject of analytics.bySubject; track subject.subject) {
                    <div class="bar-item">
                        <div class="bar-label">
                            {{ getSubjectIcon(subject.subject) }} {{ subject.subject }}
                        </div>
                        <div class="bar-track">
                            <div class="bar-fill" [style.width.%]="subject.accuracy"
                                [style.background]="subject.accuracy >= 80 ? '#22c55e' : subject.accuracy >= 60 ? '#000' : '#ef4444'">
                                <span class="bar-value">{{ subject.accuracy }}%</span>
                            </div>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Difficulty Stats -->
    <div class="section">
        <h2 class="section-title">‚öôÔ∏è Desempenho por Dificuldade</h2>
        <div class="grid grid-3">
            <div class="card stat-card">
                <div class="stat-icon">üòä</div>
                <div class="stat-value">{{ analytics.byDifficulty.easy.accuracy }}%</div>
                <div class="stat-label">F√°cil ({{ analytics.byDifficulty.easy.total }} quest√µes)</div>
            </div>

            <div class="card stat-card">
                <div class="stat-icon">ü§î</div>
                <div class="stat-value">{{ analytics.byDifficulty.medium.accuracy }}%</div>
                <div class="stat-label">M√©dio ({{ analytics.byDifficulty.medium.total }} quest√µes)</div>
            </div>

            <div class="card stat-card">
                <div class="stat-icon">üò∞</div>
                <div class="stat-value">{{ analytics.byDifficulty.hard.accuracy }}%</div>
                <div class="stat-label">Dif√≠cil ({{ analytics.byDifficulty.hard.total }} quest√µes)</div>
            </div>
        </div>
    </div>

    <!-- Accuracy Breakdown -->
    <div class="section">
        <h2 class="section-title">üìà Distribui√ß√£o de Respostas</h2>
        <div class="card">
            <div class="pie-chart"
                [style]="getPieChartStyle(analytics.overview.correctAnswers, analytics.overview.totalQuestions)">
            </div>
            <div class="pie-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #000;"></div>
                    <span>Acertos ({{ analytics.overview.correctAnswers }})</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e5e5e5;"></div>
                    <span>Erros ({{ analytics.overview.totalQuestions - analytics.overview.correctAnswers }})</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Insights -->
    @if (analytics.insights.length > 0) {
    <div class="section">
        <h2 class="section-title">üí° Insights</h2>
        <div class="grid grid-2">
            @for (insight of analytics.insights; track insight.title) {
            <div class="insight-card" [class]="insight.type">
                <div class="insight-icon">{{ insight.icon }}</div>
                <div class="insight-content">
                    <div class="insight-title">{{ insight.title }}</div>
                    <div class="insight-desc">{{ insight.description }}</div>
                </div>
            </div>
            }
        </div>
    </div>
    }

    <!-- Recent Sessions -->
    @if (analytics.recentSessions.length > 0) {
    <div class="section">
        <h2 class="section-title">üïí Sess√µes Recentes</h2>
        <div class="card">
            <table class="session-table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Tipo</th>
                        <th>Quest√µes</th>
                        <th>XP Ganho</th>
                        <th>Dura√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    @for (session of analytics.recentSessions; track session.id) {
                    <tr>
                        <td>{{ formatDate(session.date) }}</td>
                        <td>
                            <span class="badge" [class]="session.type">
                                {{ session.type === 'quiz' ? 'Simulado' : 'Interpreta√ß√£o' }}
                            </span>
                        </td>
                        <td>{{ session.questionsCount }}</td>
                        <td>+{{ session.earnedXP }} XP</td>
                        <td>{{ formatDuration(session.duration) }}</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    }

    } @else {
    <div class="empty-state">
        <div class="empty-icon">üìä</div>
        <p>Nenhum dado dispon√≠vel ainda. Comece respondendo quest√µes!</p>
    </div>
    }
</div>